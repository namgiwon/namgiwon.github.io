---
layout: post
title: 스프링 부트 Cache
tags:
  - spring boot
  - Cache
  - 
---

## 스프링 부트에 Cache 설정 하는 법

* ehcache.xml 생성

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="http://ehcache.org/ehcache.xsd"
         updateCheck="false">
    <diskStore path="java.io.tmpdir" />

    <cache name="findCouponCache"
           maxEntriesLocalHeap="10000"
           maxEntriesLocalDisk="1000"
           eternal="false"
           diskSpoolBufferSizeMB="20"
           timeToIdleSeconds="300" timeToLiveSeconds="600"
           memoryStoreEvictionPolicy="LFU"
           transactionalMode="off">
        <persistence strategy="localTempSwap" />
    </cache>

</ehcache>
```

* 메인 클래스에 @EnableCache 설정

```java
@EnableCaching
@EnableScheduling
@EnableJpaAuditing
@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

}
```

* 메서드에 선언하고 사용하면 됨

```java
@Cacheable(value = "value", key = "#customerId+#limit")
public List<Coupon> getCoupons() {
    return couponRepository.getCoupons(customerId, limit);
}
```

## 주의점

* 한 클래스 안에 @Cacheable이 선언되지 않은 메서드에서 @Cacheable이 선언된 메서드를 호출하면 적용되지 않음

* 스택오버플로우 뒤져보니, 스프링은 AOP를 통해서 어노테이션의 기능이 적용된 프록시 클래스를 생성하는데, 내부 호출은 이 프록시를 사용하지 않기 때문이라 함.

* [여기](https://stackoverflow.com/questions/39072235/spring-boot-caching-in-service-class-does-not-work/39072457)가서 스크롤 좀 내리면 확인할 수 있음

>You have two methods in your SettingsService, one that is cached (getGlobalEnumValue(...)) and another one >that isn't cached, but calls the other method (getGlobalSettingsValue(...)).
>
>The way the Spring cache abstraction works however is by proxying your class (using Spring AOP). However, >calls to methods within the same class will not call the proxied logic, but the direct business logic >beneath. This means caching does not work if you're calling methods in the same bean.
>
>So, if you're calling getGlobalSettingsValue(), it will not populate, nor use the cache when that method >calls getGlobalEnumValue(...).
